import pandas as pd
import numpy as np
import os
from sklearn.preprocessing import LabelEncoder
from tensorflow.keras.utils import load_img, img_to_array, to_categorical

def load_from_csv(csv_file, img_folder, target_size=(32, 32)):
    df = pd.read_csv(csv_file)
    images, labels = [], []
    
    for _, row in df.iterrows():
        img_path = os.path.join(img_folder, row["filename"])
        img = load_img(img_path, target_size=target_size)   # resize
        img_array = img_to_array(img)
        images.append(img_array)
        labels.append(row["label"])
    
    # Convert to numpy arrays
    images = np.array(images, dtype="float32") / 255.0   # normalize
    labels = np.array(labels)
    
    # Encode labels (if theyâ€™re text)
    encoder = LabelEncoder()
    labels = encoder.fit_transform(labels)
    labels = to_categorical(labels)   # one-hot encoding
    
    return images, labels

# Example usage:
train_images, train_labels = load_from_csv("train.csv", "dataset/train")
test_images, test_labels   = load_from_csv("test.csv", "dataset/test")

print(train_images.shape, train_labels.shape)
print(test_images.shape, test_labels.shape)